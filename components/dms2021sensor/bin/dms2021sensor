#!/usr/bin/env python3

import time
import logging
from flask import Flask, request
from flask.logging import default_handler

from dms2021core.data.rest import RestResponse
from dms2021sensor.presentation.rest import sensorService

app = Flask(__name__)
root_logger = logging.getLogger()
root_logger.addHandler(default_handler)
sensor_rest_api: sensorService = sensorService()

@app.route('/', methods=['GET'])
def is_running():
    return ('', 200, {'Content-Type': 'text/plain'})

@app.route('/sensorAbs', methods=['GET']) #/que?
def create_sensor():
    print("Escoja el tipo de sensor a consultar")
    print("[1] Sensor memoria RAM")
    print("[2] Sensor memoria Swap")
    print("[3] Sensor peso archivo")
    
    try:
        sensor_type: str = request.form['tipo sensor:']
    except KeyError:
        sensor_type: str = '1'
    response: RestResponse = sensor_rest_api.monitorizarSensor(int(sensor_type))
    return (response.get_content(), response.get_code(), {'Content-Type': response.get_mime_type()})


if __name__ == '__main__':
    while True:
        time.sleep(1)
